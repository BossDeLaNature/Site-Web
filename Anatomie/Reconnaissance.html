<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Reconnaissance image anatomie</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #f8f9fa;
    }
    .results-list {
      position: absolute;
      z-index: 1000;
      width: 100%;
      max-height: 150px;
      overflow-y: auto;
      background: white;
      border: 1px solid #ccc;
      border-top: none;
      border-radius: 0 0 .5rem .5rem;
    }
    #feedback .card {
  border-left: 5px solid #0d6efd;
  background-color: #fdfdfe;
}

    .results-list li {
      padding: 8px 12px;
      cursor: pointer;
    }
    .results-list li:hover {
      background-color: #f8f9fa;
    }
    .explication {
      font-size: 0.9rem;
      margin-top: 0.5rem;
      border-left: 3px solid #0d6efd;
      padding-left: 0.5rem;
      color: #555;
    }
  </style>
</head>
<body class="p-4">

  <div class="container text-center">
    <h3 class="mb-4">Reconnaissance</h3>

    <!-- Barre de progression -->
    <div class="d-flex justify-content-between align-items-center mb-2">
      <div id="progressText" class="fw-bold">Question 1 / 2</div>
      <select id="questionSelect" class="form-select w-auto">
        <!-- Options ajoutées dynamiquement -->
      </select>
    </div>

    <div class="progress mb-4" style="height: 20px;">
      <div id="progressBar" class="progress-bar" role="progressbar" style="width: 0%">0%</div>
    </div>

    <!-- Image -->
    <img id="quizImage" src="" alt="" class="img-fluid mb-4 rounded shadow" style="max-width: 600px;">

    <img id="quizImage2" src="" alt="" class="img-fluid mb-4 rounded shadow d-none" style="max-width: 600px;">

    <!-- Questions -->
    <div id="questionTitle" class="fs-5 fw-bold mb-3"></div>
    <form id="quizForm" class="mx-auto" style="max-width: 500px;"></form>

    <!-- Boutons -->
    <div class="d-flex justify-content-center gap-2 mt-3">
      <button id="prevBtn" class="btn btn-outline-secondary">⬅️ Précédente</button>
      <button id="checkBtn" class="btn btn-primary">Vérifier</button>
      <button id="nextBtn" class="btn btn-outline-secondary">Suivante ➡️</button>
    </div>

    <button id="showExplanations" class="btn btn-outline-info mt-3 d-none">Afficher les explications</button>

    <div id="feedback" class="mt-4"></div>
  </div>

  <script>
    // === Données du quiz ===
    let quizData = [];

  fetch("data/Reconnaissance.json")
    .then(response => response.json())
    .then(data => {
      quizData = data;
      loadQuestion(0);
    })
    .catch(err => console.error("Erreur chargement JSON :", err));

    // === Base de données pour autocomplétion ===
    let database = [];

    fetch("data/databaseReconnaissance.json")
      .then(response => response.json())
      .then(data => {
        database = data;
      })
      .catch(err => console.error("Erreur chargement database :", err));

    let currentIndex = 0;
    const quizImage = document.getElementById("quizImage");
    const quizImage2 = document.getElementById("quizImage2");
    const quizForm = document.getElementById("quizForm");
    const feedback = document.getElementById("feedback");
    const title = document.getElementById("questionTitle");
    const checkBtn = document.getElementById("checkBtn");
    const showBtn = document.getElementById("showExplanations");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const progressBar = document.getElementById("progressBar");
    const progressText = document.getElementById("progressText");
    const questionSelect = document.getElementById("questionSelect");

    // === Initialisation du menu déroulant ===


    document.getElementById("questionSelect").addEventListener('click', () => {
      questionSelect.innerHTML = ''
      quizData.forEach((q, i) => {
        const opt = document.createElement("option");
        opt.value = i;
        opt.textContent = `Question ${i + 1}`;
        questionSelect.appendChild(opt);
      });


    });






    // === Afficher une question ===
    function loadQuestion(index) {
      const q = quizData[index];
      quizImage2.classList.add("d-none");
      title.textContent = q.titre;
      quizImage.src = q.image;
      quizForm.innerHTML = "";
      feedback.innerHTML = "";
      showBtn.classList.add("d-none");

      q.reponses.forEach(rep => {
        const div = document.createElement("div");
        div.classList.add("mb-3", "position-relative");

        const label = document.createElement("label");
        label.innerHTML = `<strong>${rep.numero}.</strong>`;
        label.classList.add("me-2");

        const input = document.createElement("input");
        input.type = "text";
        input.classList.add("form-control", "mt-1");
        input.placeholder = `Réponse ${rep.numero}`;
        input.dataset.numero = rep.numero;
        input.autocomplete = "off";

        const list = document.createElement("ul");
        list.classList.add("list-group", "results-list", "d-none");

        const explicationDiv = document.createElement("div");
        explicationDiv.classList.add("explication", "d-none");
        explicationDiv.id = `explication-${rep.numero}`;

        div.appendChild(label);
        div.appendChild(input);
        div.appendChild(list);
        div.appendChild(explicationDiv);
        quizForm.appendChild(div);

        // Autocomplétion
        input.addEventListener("input", () => {
          const query = input.value.toLowerCase().trim();
          list.innerHTML = "";
          if (!query) return list.classList.add("d-none");

          const filtered = database.filter(item => item.toLowerCase().includes(query));
          if (filtered.length === 0) return list.classList.add("d-none");

          filtered.forEach(result => {
            const li = document.createElement("li");
            li.textContent = result;
            li.classList.add("list-group-item");
            li.addEventListener("click", () => {
              input.value = result;
              list.classList.add("d-none");
            });
            list.appendChild(li);
          });

          list.classList.remove("d-none");
        });

        document.addEventListener("click", (e) => {
          if (!e.target.closest(".position-relative")) list.classList.add("d-none");
        });
      });

      // Mise à jour des contrôles
      prevBtn.disabled = currentIndex === 0;
      nextBtn.disabled = currentIndex === quizData.length - 1;
      questionSelect.value = currentIndex;
      updateProgress();
    }

    // === Barre de progression ===
    function updateProgress() {
      const total = quizData.length;
      const progress = ((currentIndex + 1) / total) * 100;
      progressBar.style.width = `${progress}%`;
      progressBar.textContent = `${Math.round(progress)}%`;
      progressText.textContent = `Question ${currentIndex + 1} / ${total}`;
    }

    // === Vérifier les réponses ===
    // === Vérifier les réponses ===
    checkBtn.addEventListener("click", () => {
      const q = quizData[currentIndex];
      quizImage2.src = q.image2;
      const inputs = quizForm.querySelectorAll("input");
      let bonnes = 0;
      let explicationsHTML = "";

      // Nettoyage visuel
      inputs.forEach(input => {
        input.classList.remove("is-valid", "is-invalid");
      });

      if (q.ordre) {
        // Vérification stricte de l'ordre
        inputs.forEach((input, idx) => {
          const valeur = input.value.trim();
          const rep = q.reponses[idx];

          if (valeur.toLowerCase() === rep.correct.toLowerCase()) {
            input.classList.add("is-valid");
            bonnes++;
            explicationsHTML += `
              <div class="mb-2 text-success">
                <strong>✅ Réponse ${rep.numero} :</strong> ${rep.correct}<br>
                <span class="text-muted">${rep.explication}</span>
              </div>
            `;
          } else {
            input.classList.add("is-invalid");
            explicationsHTML += `
              <div class="mb-2 text-danger">
                <strong>❌ Réponse ${rep.numero} :</strong> ${rep.correct}<br>
                <span class="text-muted">${rep.explication}</span>
              </div>
            `;
          }
        });

      } else {
        // Vérification sans ordre
        const reponsesAttendues = q.reponses.map(r => r.correct.toLowerCase());
        const reponsesTrouvees = Array.from(inputs).map(i => i.value.trim().toLowerCase());

        q.reponses.forEach(rep => {
          const idxMatch = reponsesTrouvees.findIndex(r => r === rep.correct.toLowerCase());

          if (idxMatch !== -1) {
            inputs[idxMatch].classList.add("is-valid");
            bonnes++;
            explicationsHTML += `
              <div class="mb-2 text-success">
                <strong>✅ Réponse ${rep.numero} :</strong> ${rep.correct}<br>
                <span class="text-muted">${rep.explication}</span>
              </div>
            `;
          } else {
            explicationsHTML += `
              <div class="mb-2 text-danger">
                <strong>❌ Réponse ${rep.numero} :</strong> ${rep.correct}<br>
                <span class="text-muted">${rep.explication}</span>
              </div>
            `;
          }
        });
      }

      // Affichage du score et des explications
      const total = q.reponses.length;
      feedback.innerHTML = `
        <div class="alert ${bonnes === total ? "alert-success" : "alert-warning"}">
          <strong>${bonnes}/${total}</strong> bonnes réponses
        </div>
        <div class="card mt-3 text-start">
          <div class="card-body">
            <h6 class="fw-bold mb-2">Explications :</h6>
            ${explicationsHTML}
          </div>
        </div>
      `;
      quizImage2.classList.remove("d-none");

      showBtn.classList.add("d-none");
    });



    // === Navigation ===
    prevBtn.addEventListener("click", () => {
      if (currentIndex > 0) {
        currentIndex--;
        loadQuestion(currentIndex);
      }
    });
    nextBtn.addEventListener("click", () => {
      if (currentIndex < quizData.length - 1) {
        currentIndex++;
        loadQuestion(currentIndex);
      }
    });
    questionSelect.addEventListener("change", () => {
      currentIndex = parseInt(questionSelect.value);
      loadQuestion(currentIndex);
    });

    // === Initialisation ===
    loadQuestion(currentIndex);
  </script>
</body>
</html>
