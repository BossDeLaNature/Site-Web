<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Quiz de S√©miologie</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #f8f9fa;
    }
    .results-list {
      position: absolute;
      z-index: 1000;
      width: 100%;
      max-height: 150px;
      overflow-y: auto;
      background: white;
      border: 1px solid #ccc;
      border-top: none;
      border-radius: 0 0 .5rem .5rem;
    }
    .results-list li {
      padding: 8px 12px;
      cursor: pointer;
    }
    .results-list li:hover {
      background-color: #f8f9fa;
    }
    .explication {
      font-size: 0.9rem;
      margin-top: 0.5rem;
      border-left: 3px solid #0d6efd;
      padding-left: 0.5rem;
      color: #555;
    }
  </style>
</head>
<body class="p-4">

  <div class="container text-center">
    <h3 class="mb-4">üß† Quiz de S√©miologie</h3>

    <!-- Barre de progression -->
    <div class="d-flex justify-content-between align-items-center mb-2">
      <div id="progressText" class="fw-bold">Question 1 / 2</div>
      <select id="questionSelect" class="form-select w-auto">
        <!-- Options ajout√©es dynamiquement -->
      </select>
    </div>

    <div class="progress mb-4" style="height: 20px;">
      <div id="progressBar" class="progress-bar" role="progressbar" style="width: 0%">0%</div>
    </div>

    <!-- Image -->
    <img id="quizImage" src="" alt="Illustration" class="img-fluid mb-4 rounded shadow" style="max-width: 600px;">

    <!-- Questions -->
    <div id="questionTitle" class="fs-5 fw-bold mb-3"></div>
    <form id="quizForm" class="mx-auto" style="max-width: 500px;"></form>

    <!-- Boutons -->
    <div class="d-flex justify-content-center gap-2 mt-3">
      <button id="prevBtn" class="btn btn-outline-secondary">‚¨ÖÔ∏è Pr√©c√©dente</button>
      <button id="checkBtn" class="btn btn-primary">V√©rifier</button>
      <button id="nextBtn" class="btn btn-outline-secondary">Suivante ‚û°Ô∏è</button>
    </div>

    <button id="showExplanations" class="btn btn-outline-info mt-3 d-none">Afficher les explications</button>

    <div id="feedback" class="mt-4"></div>
  </div>

  <script>
    // === Donn√©es du quiz ===
    let quizData = [];

  fetch("quizData.json")
    .then(response => response.json())
    .then(data => {
      quizData = data;
      loadQuestion(0);
    })
    .catch(err => console.error("Erreur chargement JSON :", err));

    // === Base de donn√©es pour autocompl√©tion ===
    let database = [];

    fetch("database.json")
      .then(response => response.json())
      .then(data => {
        database = data;
      })
      .catch(err => console.error("Erreur chargement database :", err));

    let currentIndex = 0;
    const quizImage = document.getElementById("quizImage");
    const quizForm = document.getElementById("quizForm");
    const feedback = document.getElementById("feedback");
    const title = document.getElementById("questionTitle");
    const checkBtn = document.getElementById("checkBtn");
    const showBtn = document.getElementById("showExplanations");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const progressBar = document.getElementById("progressBar");
    const progressText = document.getElementById("progressText");
    const questionSelect = document.getElementById("questionSelect");

    // === Initialisation du menu d√©roulant ===
    quizData.forEach((q, i) => {
      const opt = document.createElement("option");
      opt.value = i;
      opt.textContent = `Question ${i + 1} ‚Äì ${q.titre}`;
      questionSelect.appendChild(opt);
    });

    // === Afficher une question ===
    function loadQuestion(index) {
      const q = quizData[index];
      title.textContent = q.titre;
      quizImage.src = q.image;
      quizForm.innerHTML = "";
      feedback.innerHTML = "";
      showBtn.classList.add("d-none");

      q.reponses.forEach(rep => {
        const div = document.createElement("div");
        div.classList.add("mb-3", "position-relative");

        const label = document.createElement("label");
        label.innerHTML = `<strong>${rep.numero}.</strong>`;
        label.classList.add("me-2");

        const input = document.createElement("input");
        input.type = "text";
        input.classList.add("form-control", "mt-1");
        input.placeholder = `R√©ponse ${rep.numero}`;
        input.dataset.numero = rep.numero;
        input.autocomplete = "off";

        const list = document.createElement("ul");
        list.classList.add("list-group", "results-list", "d-none");

        const explicationDiv = document.createElement("div");
        explicationDiv.classList.add("explication", "d-none");
        explicationDiv.id = `explication-${rep.numero}`;

        div.appendChild(label);
        div.appendChild(input);
        div.appendChild(list);
        div.appendChild(explicationDiv);
        quizForm.appendChild(div);

        // Autocompl√©tion
        input.addEventListener("input", () => {
          const query = input.value.toLowerCase().trim();
          list.innerHTML = "";
          if (!query) return list.classList.add("d-none");

          const filtered = database.filter(item => item.toLowerCase().includes(query));
          if (filtered.length === 0) return list.classList.add("d-none");

          filtered.forEach(result => {
            const li = document.createElement("li");
            li.textContent = result;
            li.classList.add("list-group-item");
            li.addEventListener("click", () => {
              input.value = result;
              list.classList.add("d-none");
            });
            list.appendChild(li);
          });

          list.classList.remove("d-none");
        });

        document.addEventListener("click", (e) => {
          if (!e.target.closest(".position-relative")) list.classList.add("d-none");
        });
      });

      // Mise √† jour des contr√¥les
      prevBtn.disabled = currentIndex === 0;
      nextBtn.disabled = currentIndex === quizData.length - 1;
      questionSelect.value = currentIndex;
      updateProgress();
    }

    // === Barre de progression ===
    function updateProgress() {
      const total = quizData.length;
      const progress = ((currentIndex + 1) / total) * 100;
      progressBar.style.width = `${progress}%`;
      progressBar.textContent = `${Math.round(progress)}%`;
      progressText.textContent = `Question ${currentIndex + 1} / ${total}`;
    }

    // === V√©rifier les r√©ponses ===
    checkBtn.addEventListener("click", () => {
      const q = quizData[currentIndex];
      const inputs = quizForm.querySelectorAll("input");
      let bonnes = 0;

      inputs.forEach(input => {
        const numero = parseInt(input.dataset.numero);
        const valeur = input.value.trim();
        const rep = q.reponses.find(r => r.numero === numero);
        const expDiv = document.getElementById(`explication-${numero}`);

        if (!rep) return;

        if (valeur.toLowerCase() === rep.correct.toLowerCase()) {
          input.classList.add("is-valid");
          input.classList.remove("is-invalid");
          bonnes++;
        } else {
          input.classList.add("is-invalid");
          input.classList.remove("is-valid");
        }

        expDiv.innerHTML = `<strong>Bonne r√©ponse :</strong> ${rep.correct}<br>${rep.explication}`;
        expDiv.classList.add("d-none");
      });

      const total = q.reponses.length;
      feedback.innerHTML = `
        <div class="alert ${bonnes === total ? "alert-success" : "alert-warning"}">
          ${bonnes}/${total} bonnes r√©ponses
        </div>
      `;
      showBtn.classList.remove("d-none");
    });

    // === Afficher / masquer explications ===
    showBtn.addEventListener("click", () => {
      const exps = document.querySelectorAll(".explication");
      const hidden = Array.from(exps).every(div => div.classList.contains("d-none"));
      exps.forEach(div => div.classList.toggle("d-none", !hidden));
      showBtn.textContent = hidden ? "Masquer les explications" : "Afficher les explications";
    });

    // === Navigation ===
    prevBtn.addEventListener("click", () => {
      if (currentIndex > 0) {
        currentIndex--;
        loadQuestion(currentIndex);
      }
    });
    nextBtn.addEventListener("click", () => {
      if (currentIndex < quizData.length - 1) {
        currentIndex++;
        loadQuestion(currentIndex);
      }
    });
    questionSelect.addEventListener("change", () => {
      currentIndex = parseInt(questionSelect.value);
      loadQuestion(currentIndex);
    });

    // === Initialisation ===
    loadQuestion(currentIndex);
  </script>
</body>
</html>
